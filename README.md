# Ball and Beam

## Description
A ball and beam system is a classic example of a control system often used in engineering and control theory education. It consists of a horizontal beam, typically with one end fixed and the other free to move, and a ball placed on top of the beam. The objective is to control the position of the ball along the beam using various control techniques.

The ball's position along the beam is usually controlled by applying a force or torque to tilt the beam, which causes the ball to roll along it. Sensors are typically employed to measure the position of the ball, and a controller adjusts the applied force or torque to maintain the desired position.

The ball and beam system is often used to teach concepts such as feedback control, stability, system identification, and control system design. It serves as a simple yet effective platform for students and researchers to experiment with different control algorithms and techniques.

In a ball and beam system, the inputs and outputs can be defined as follows:

**Inputs:**

- Control Input: The primary input to the ball and beam system is the angle of the beam. This inturn determines the amount of force or torque applied to the beam to control the position of the ball. This control signal is generated by a controller based on the desired position of the ball and the feedback from sensors.

**Outputs:**

- Ball Position: The output of the ball and beam system is the position of the ball along the beam. This position is typically measured using sensors such as potentiometers or encoders that detect the angle or displacement of the beam.
The control input influences the position of the ball, which in turn affects the output of the system. By adjusting the control input based on the feedback from the sensors, the system can maintain the desired position of the ball along the beam.

The goal of the control system is to regulate the position of the ball despite disturbances or changes in the environment, thus achieving the desired control objective. This process involves designing and implementing appropriate control algorithms that take into account the dynamics of the ball and beam system, as well as factors such as friction, gravity, and sensor noise.


![Figure1: The configuration of Ball and Beam](source/Ball_and_beam.png)
_Figure1: The configuration of Ball and Beam [1]_

[1] Ding, Meiling, Bingyou Liu, and Lichao Wang. "Position control for ball and beam system based on active disturbance rejection control." Systems Science & Control Engineering 7.1 (2019): 97-108.
## Equations
Dynamics of a ball and beam system [1] can be formulated as
$$
\begin{equation}
(\frac{J}{R_{b}^{2}} + m) \ddot{r} -mr\dot{\alpha}^{2} + mg \sin(\alpha) = 0
\end{equation}
$$

$$
\begin{equation}
(J_{M} + mr^{2}) \ddot{\alpha} + 2mr\dot{r}\dot{\alpha}(mgr + \frac{1}{2}MgL)\cos(\alpha) = \tau_{r}
\end{equation}
$$



$$
\begin{equation}
\alpha = \frac{d}{L} \theta
\end{equation}
$$

Where $\ J \in R^{1 \times 1}$, $\ m \in R^{1 \times 1}$, $\ R_{b} \in R^{1 \times 1}$, $\ r \in R^{1 \times 1}$, $\alpha \in R^{1 \times 1}$, $\ g \in R^{1 \times 1}$, $\ L \in R^{1 \times 1}$, $\ M \in R^{1 \times 1}$, $\ J_{M} \in R^{1 \times 1}$, $\tau_{r}\in R^{1 \times 1}$ and $\theta \in R^{1 \times 1}$ denote the moment inertia, mass, radius, position of the ball, rotation angle of the beam, gravitational acceleration, length, mass, and inertia of the beam, input torque and turning angle of the wheel, respectively.

Substitung $\alpha$ in (1) with its  $\frac{d}{L}\theta$ , yields to
$$
\begin{equation}
\ddot{r} = \frac{1}{ ( \frac{J}{R_{b}^{2}} + m) }(mr(\frac{d}{L} \dot{\theta})^{2} - mg \sin(\frac{d}{L} \theta))
\end{equation}
$$

$$
\begin{equation}
\ddot{\theta} = \frac{\tau_{r} - (2mr\dot{r}\frac{d}{L} \dot{\theta}(mgr + \frac{1}{2}MgL)\cos(\frac{d}{L} \theta))}{(J_{M} + mr^{2}) \frac{d}{L}}
\end{equation}
$$
To make it more realistic, we assume two independently governed electrical motors are producing the required input torques. The dynamics of a PMDC motor [1] can be formulated as

$$
\begin{equation}
J\ddot{\phi} + B\dot{\phi} + r_{g}\tau_{r} = \tau
\end{equation}
$$

$$
\begin{equation}
L\dot{I} + K_{b}\dot{\phi} + RI = V
\end{equation}
$$


$$
\begin{equation}
\tau = K_{\tau}I
\end{equation}
$$


where $\ J \in R^{1 \times 1}$, $\phi \in R^{1 \times 1}$, $\ B \in R^{1 \times 1}$, $\ r_{g} \in R^{1 \times 1}$, $\tau_r \in R^{1 \times 1}$ and $\tau \in R^{1 \times 1}$ denote motor's inertia, rotor position, damping, gear ratio, load, rspectively. 

$\ L \in R^{1 \times 1}$, $\ I \in R^{1 \times 1}$, $\ K_{b} \in R^{1 \times 1}$, $\ R \in R^{1 \times 1}$ and $\ V \in R^{1 \times 1}$ present motor's inductance, current, back-emf, resistance and input voltage, respectively. 

$\ K_{\tau} \in R^{1 \times 1}$ is the constant matrix that maps the motor's current to its torque.

Since the electrical motor is connected through a gearbox to the wheel, one can suggest

$$
\begin{equation}
\dot{\phi} = r_{g}^{-1}\theta
\end{equation}
$$
substituting $\phi$ and its time derivatives with equivalents yields to

$$
\begin{equation}
\tau_{r} = r_{g}^{-1}K_{\tau}I -r_{g}^{-1}(Jr_{g}^{-1}\ddot{\theta} + Br_{g}^{-1}\dot{\theta})
\end{equation}
$$

$$
\begin{equation}
L\dot{I} = V - (K_{b}r_{g}^{-1}\dot{\theta} + RI )
\end{equation}
$$
therefore, an electrically driven Ball and Beam can be modeled via
$$
\begin{equation}
\begin{matrix}
\ddot{r} = \frac{1}{ ( \frac{J}{R_{b}^{2}} + m) }(mr(\frac{d}{L} \dot{\theta})^{2} - mg \sin(\frac{d}{L} \theta)) \\

\ddot{\theta} = \frac{1}{{(J_{M} + mr^{2}) \frac{d}{L}}} (r_{g}^{-1}K_{\tau}I -r_{g}^{-1}(Jr_{g}^{-1}\ddot{\theta} + Br_{g}^{-1}\dot{\theta}) - (2mr\dot{r}\frac{d}{L} \dot{\theta}(mgr + \frac{1}{2}MgL)\cos(\frac{d}{L} \theta))) \\

\dot{I} = L^{-1}V - L^{-1}(K_{b}r_{g}^{-1}\dot{\theta} + RI ) \\
\end{matrix}
\end{equation}
$$
## Constants

| $\ J[Kgm^{2}]$ | $\ m[Kg]$ | $\ R_{b}[m]$ | $\ g[m/s^{2}]$ | $\ L[m]$ | $\ M[Kg]$ | $\ J_{M}[Kgm^{2}]$ |  $\ d[m]$ |
|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|
| 9.9e-6 | 0.1 | 0.015 | 9.8 | 0.3 | 0.5 | 0.006 | 0.04 |

A stable Motor coefficient:
| $\ V_{max}[V]$ | $\ R[\Omega]$ | $\ L[H]$ | $\ K_{b}[Vs/rad]$ | $\ K_{\tau}[Nm/A]$ | $\ J[Nms^{2}/rad]$ | $\ B[Nms/rad]$ | $\(r_{g}\)$ |
|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|
| 24 | 2.0 | 0.5 | 0.1 | 0.1 | 0.01 | 0.02 | 0.1 |

An unstable Motor coefficient:
| $\ V_{max}[V]$ | $\ R[\Omega]$ | $\ L[H]$ | $\ K_{b}[Vs/rad]$ | $\ K_{\tau}[Nm/A]$ | $\ J[Nms^{2}/rad]$ | $\ B[Nms/rad]$ | $\(r_{g}\)$ |
|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|:--------:|
| 40 | 1.6 | 0.001 | 0.26 | 0.26 | 0.0002 | 0.001 | 0.1 |

## Analysis
Assume the mid-point of the beam is the orgin on the beam. 

**Q1.**  Write down the compact ODE which maps the voltage of the motor to acceleration in task space. make a reasonable simulation of the system. Linearize the system over any given equilibrium point.

**Q2.** Create a tranfer function out of the linearized model and Analyze it.

**Q3.** Design a controller that can move the ball from any initial position on the beam to any given set point and keep it there.

